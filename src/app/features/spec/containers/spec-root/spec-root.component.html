<ng-container *ngIf="route.params | async as params">
  <form class="specification">
    <mat-form-field>
      <mat-select
          placeholder="Specification" name="specification"
          [value]="params.specification"
          (selectionChange)="router.navigate(['/spec', $event.value,  0, 0, 0])"
      >
        <mat-option [value]="'websocket'">WebSocket</mat-option>
        <mat-option [value]="'restapi'">RestApi</mat-option>
      </mat-select>
    </mat-form-field>
  </form>
  <mat-tab-group
      [selectedIndex]="params.module"
      (selectedIndexChange)="router.navigate(['/spec', params.specification, $event, 0, 0])"
      *ngIf="messages$ | async as messages"
    >
    <mat-tab [label]="message.name" *ngFor="let message of messages">
      <ng-template matTabContent>
        <mat-card class="spec-card shadowed">
          <mat-card-header>
            <div mat-card-avatar class="spec-header-image"><mat-icon color="primary">{{message.icon}}</mat-icon></div>
            <mat-card-title>{{message.name}}</mat-card-title>
            <mat-card-subtitle>{{message.description}}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <mat-accordion class="spec-headers-align">
              <mat-expansion-panel
                  [expanded]="params.action == idx"
                  (opened)="router.navigate(['/spec', params.specification, params.module, idx, params.tab])"
                  *ngFor="let spec of message.spec;let idx = index"
              >
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    <mat-chip-list>
                      <spec-chip [verb]="spec.verb"></spec-chip>
                      {{spec.name}}
                    </mat-chip-list>
                  </mat-panel-title>
                  <mat-panel-description>
                    {{spec.summary}}
                  </mat-panel-description>
                </mat-expansion-panel-header>
                <p>{{spec.description}}</p>
                <mat-tab-group
                    [selectedIndex]="params.tab"
                    (selectedIndexChange)="router.navigate(['/spec', params.specification, params.module, params.action, $event])"
                >
                  <mat-tab label="FIELDS" *ngIf="isNotEmpty(spec.fields)">
                    <spec-fields [fields]="spec.fields"></spec-fields>
                  </mat-tab>
                  <mat-tab label="EXAMPLE" *ngIf="isNotEmpty(spec.clientMessage)">
                    <spec-code [jsonData]="spec.clientMessage"></spec-code>
                  </mat-tab>
                  <mat-tab label="SUCCESS" *ngIf="isNotEmpty(spec.serverMessage.success)">
                    <mat-chip-list>
                      <mat-chip color="accent" selected="true" *ngIf="spec.serverMessage.success.status">
                        {{spec.serverMessage.success.status}}
                      </mat-chip>
                      {{spec.serverMessage.success.description}}
                    </mat-chip-list>
                    <spec-code [jsonData]="spec.serverMessage.success.data"></spec-code>
                  </mat-tab>
                  <mat-tab label="ERROR" *ngIf="spec.serverMessage.errors.length">
                    <div *ngFor="let error of spec.serverMessage.errors; let last = last">
                      <mat-chip-list>
                        <mat-chip color="warn" selected="true" *ngIf="error.status">{{error.status}}</mat-chip>
                        {{error.description}}
                      </mat-chip-list>
                      <spec-code [jsonData]="error.data"></spec-code>
                      <ng-container *ngIf="!last">
                        <mat-divider></mat-divider>
                        <mat-divider></mat-divider>
                        <br />
                      </ng-container>
                    </div>
                  </mat-tab>
                </mat-tab-group>
              </mat-expansion-panel>
            </mat-accordion>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</ng-container>